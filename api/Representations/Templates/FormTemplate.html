<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>//{{TITLE}}</title>
  <link rel="stylesheet" type="text/css" href="/static/jsonforms/deps/opt/bootstrap.css" />
</head>

<body>
  <h2 class="text-center">//{{TITLE}}</h2>
  <form class="container"></form>
  <div id="res" class="text-center alert"></div>
  <script type="text/javascript" src="/static/jsonforms/deps/jquery.min.js"></script>
  <script type="text/javascript" src="/static/jsonforms/deps/underscore.js"></script>
  <script type="text/javascript" src="/static/jsonforms/deps/opt/jsv.js"></script>
  <script type="text/javascript" src="/static/jsonforms/lib/jsonform.js"></script>
  <script type="text/javascript">
    $("form").jsonForm({
      //{{SCHEMA}},
      form: [
        "*",
        {
          "type": "submit",
          "title": "Submit"
        },
        {
          "type": "button",
          "title": "Delete",
          "htmlClass": "//{{DELETE_VISIBLE}} btn btn-danger",
          "onClick": function (e) { onDelete(e); }
        }
      ],
      onSubmitValid: function (obj) {

        var url = "//{{POST_URI}}";

        var xhr = new XMLHttpRequest();
        xhr.open("POST", url);
        xhr.setRequestHeader("content-type", "application/json;charset=UTF-8");

        xhr.onload = function () {
          if (xhr.status === 201) {
            window.location.replace(xhr.getResponseHeader("location"));
          }
          else if (xhr.status === 200) {
            window.location.replace(url);
          }
          else if (xhr.status > 200 && xhr.status < 400) {
            $("#res").html(`Success: ${xhr.status} ${xhr.response}`);
          }
          else {
            $("#res").html(`Server Error: ${xhr.status} ${xhr.response}`);
          }
        }

        xhr.onerror = function () {
          $("#res").html("Network connection error");
        };

        xhr.send(JSON.stringify(obj));
      }
    });

    function onDelete(e) {
      if (confirm("Confirm?????"))
      {

      }
    }
  </script>
</body>

</html>