<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>//{{TITLE}}</title>
  <link rel="stylesheet" type="text/css" href="/static/jsonforms/deps/opt/bootstrap.css" />
</head>

<body>
  <h2 class="text-center">//{{TITLE}}</h2>
  <form class="container"></form>
  <div id="res" class="text-center alert"></div>
  <script type="text/javascript" src="/static/jsonforms/deps/jquery.min.js"></script>
  <script type="text/javascript" src="/static/jsonforms/deps/underscore.js"></script>
  <script type="text/javascript" src="/static/jsonforms/deps/opt/jsv.js"></script>
  <script type="text/javascript" src="/static/jsonforms/lib/jsonform.js"></script>
  <script type="text/javascript">
    var collectionUri = "//{{COLLECTION_URI}}";
    var resourceUri = "//{{RESOURCE_URI}}";
    $("form").jsonForm({
      //{{SCHEMA}},
      form: [
        "*",
        {
          "type": "submit",
          "title": "Submit",
          "htmlClass": "btn btn-success"
        },
        {
          "type": "button",
          "title": "Cancel",
          "htmlClass": "btn btn-primary",
          "onClick": function (e) { window.history.back(); }
        },
        {
          "type": "button",
          "title": "Delete",
          "htmlClass": "//{{DELETE_VISIBLE}} btn btn-danger",
          "onClick": function (e) { onDelete(e); }
        }
      ],
      onSubmitValid: function (obj) {

        var xhr = new XMLHttpRequest();
        xhr.open("POST", resourceUri);
        xhr.setRequestHeader("content-type", "application/json;charset=UTF-8");

        xhr.onload = function () {
          if (xhr.status === 200) {
            window.location.replace(resourceUri);
          }
          else {
            $("#res").html(`Unexpected response status: ${xhr.status} ${xhr.response}`);
          }
        }

        xhr.onerror = function () {
          $("#res").html("Network connection error");
        };

        xhr.send(JSON.stringify(obj));
      }
    });

    function onDelete(e) {
      if (confirm("Are you sure?")) {

        var xhr = new XMLHttpRequest();
        xhr.open("DELETE", resourceUri);

        xhr.onload = function () {
          if (xhr.status === 200) {
            window.location.replace(collectionUri);
          }
          else {
            $("#res").html(`Unexpected status code: ${xhr.status} ${xhr.response}`);
          }
        }

        xhr.onerror = function () {
          $("#res").html("Deleted Network connection error");
        };

        xhr.send(null);
      }
    }
  </script>
</body>

</html>